import React, { useState, useEffect } from 'react';
import { Star, Trophy, Zap, Brain, Target, Award } from 'lucide-react';

const DeepLearningGame = () => {
  const [gameState, setGameState] = useState('menu'); // menu, playing, result
  const [level, setLevel] = useState(1);
  const [score, setScore] = useState(0);
  const [totalScore, setTotalScore] = useState(0);
  const [trainingData, setTrainingData] = useState([]);
  const [currentQuestion, setCurrentQuestion] = useState(null);
  const [accuracy, setAccuracy] = useState(0);
  const [badges, setBadges] = useState([]);
  const [feedback, setFeedback] = useState('');

  const patterns = {
    1: { // 색깔 패턴
      name: "색깔 인식",
      description: "AI에게 빨간색과 파란색을 구별하는 법을 가르쳐주세요!",
      options: [
        { item: "🍎", answer: "빨강", color: "red" },
        { item: "🍓", answer: "빨강", color: "red" },
        { item: "🌊", answer: "파랑", color: "blue" },
        { item: "🦋", answer: "파랑", color: "blue" },
        { item: "🌹", answer: "빨강", color: "red" },
        { item: "🐳", answer: "파랑", color: "blue" }
      ]
    },
    2: { // 크기 패턴
      name: "크기 비교",
      description: "AI에게 큰 것과 작은 것을 구별하는 법을 가르쳐주세요!",
      options: [
        { item: "🐘", answer: "크다", size: "big" },
        { item: "🐜", answer: "작다", size: "small" },
        { item: "🦒", answer: "크다", size: "big" },
        { item: "🐝", answer: "작다", size: "small" },
        { item: "🐋", answer: "크다", size: "big" },
        { item: "🐛", answer: "작다", size: "small" }
      ]
    },
    3: { // 숫자 패턴
      name: "홀짝 구분",
      description: "AI에게 홀수와 짝수를 구별하는 법을 가르쳐주세요!",
      options: [
        { item: "2️⃣", answer: "짝수", type: "even" },
        { item: "3️⃣", answer: "홀수", type: "odd" },
        { item: "4️⃣", answer: "짝수", type: "even" },
        { item: "5️⃣", answer: "홀수", type: "odd" },
        { item: "6️⃣", answer: "짝수", type: "even" },
        { item: "7️⃣", answer: "홀수", type: "odd" }
      ]
    }
  };

  useEffect(() => {
    if (gameState === 'playing' && trainingData.length === 0) {
      startLevel();
    }
  }, [gameState, level]);

  const startLevel = () => {
    const pattern = patterns[level];
    const shuffled = [...pattern.options].sort(() => Math.random() - 0.5);
    const training = shuffled.slice(0, 3);
    const testing = shuffled.slice(3, 4)[0];
    
    setTrainingData(training);
    setCurrentQuestion(testing);
    setAccuracy(0);
    setFeedback('');
  };

  const startGame = () => {
    setGameState('playing');
    setScore(0);
    setLevel(1);
  };

  const trainAI = (data, userAnswer) => {
    const isCorrect = data.answer === userAnswer;
    
    if (isCorrect) {
      const newAccuracy = accuracy + 33.3;
      setAccuracy(Math.min(100, newAccuracy));
      setFeedback('✅ 정확해요! AI가 학습했어요!');
      
      if (newAccuracy >= 99) {
        setTimeout(() => testAI(), 1500);
      }
    } else {
      setFeedback('❌ 다시 생각해보세요!');
    }
    
    setTimeout(() => setFeedback(''), 2000);
  };

  const testAI = () => {
    setGameState('result');
  };

  const answerTest = (answer) => {
    const isCorrect = currentQuestion.answer === answer;
    const points = isCorrect ? 100 * level : 0;
    
    setScore(score + points);
    setTotalScore(totalScore + points);
    
    if (isCorrect) {
      setFeedback(`🎉 정답! +${points}점`);
      
      // 배지 획득
      const newBadges = [...badges];
      if (level === 1 && !badges.includes('색깔마스터')) {
        newBadges.push('색깔마스터');
      } else if (level === 2 && !badges.includes('크기박사')) {
        newBadges.push('크기박사');
      } else if (level === 3 && !badges.includes('숫자천재')) {
        newBadges.push('숫자천재');
      }
      setBadges(newBadges);
      
      setTimeout(() => {
        if (level < 3) {
          setLevel(level + 1);
          setGameState('playing');
          setTrainingData([]);
          setAccuracy(0);
        } else {
          setGameState('complete');
        }
      }, 2000);
    } else {
      setFeedback('😢 틀렸어요! 다시 도전해보세요!');
      setTimeout(() => {
        setGameState('playing');
        setTrainingData([]);
        setAccuracy(0);
      }, 2000);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 p-8">
      <div className="max-w-4xl mx-auto">
        {/* 헤더 */}
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Brain className="w-12 h-12 text-purple-600" />
            <h1 className="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
              AI 트레이너 게임
            </h1>
          </div>
          <p className="text-xl text-gray-700">딥러닝의 원리를 배워보아요!</p>
        </div>

        {/* 점수판 */}
        <div className="bg-white rounded-3xl shadow-2xl p-6 mb-6">
          <div className="flex justify-around items-center">
            <div className="text-center">
              <Trophy className="w-8 h-8 text-yellow-500 mx-auto mb-2" />
              <div className="text-2xl font-bold text-purple-600">{totalScore}</div>
              <div className="text-sm text-gray-600">총점</div>
            </div>
            <div className="text-center">
              <Target className="w-8 h-8 text-blue-500 mx-auto mb-2" />
              <div className="text-2xl font-bold text-blue-600">레벨 {level}</div>
              <div className="text-sm text-gray-600">현재 레벨</div>
            </div>
            <div className="text-center">
              <Award className="w-8 h-8 text-pink-500 mx-auto mb-2" />
              <div className="text-2xl font-bold text-pink-600">{badges.length}</div>
              <div className="text-sm text-gray-600">배지</div>
            </div>
          </div>
        </div>

        {/* 메인 게임 영역 */}
        <div className="bg-white rounded-3xl shadow-2xl p-8">
          {gameState === 'menu' && (
            <div className="text-center space-y-6">
              <div className="text-6xl mb-4">🤖</div>
              <h2 className="text-3xl font-bold text-gray-800 mb-4">
                딥러닝이 뭐예요?
              </h2>
              <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 mb-6">
                <p className="text-lg text-gray-700 leading-relaxed">
                  딥러닝은 컴퓨터가 <span className="font-bold text-purple-600">예시를 보고 배우는</span> 기술이에요!
                  <br />
                  사람처럼 여러 번 연습하면서 점점 더 <span className="font-bold text-pink-600">똑똑해져요</span> 🧠
                  <br />
                  <br />
                  이 게임에서는 AI에게 패턴을 가르쳐주고,
                  <br />
                  AI가 새로운 문제를 풀 수 있는지 테스트해볼 거예요!
                </p>
              </div>
              <button
                onClick={startGame}
                className="bg-gradient-to-r from-purple-500 to-pink-500 text-white text-2xl font-bold px-12 py-4 rounded-full hover:from-purple-600 hover:to-pink-600 transform hover:scale-105 transition-all shadow-lg"
              >
                게임 시작하기! 🚀
              </button>
            </div>
          )}

          {gameState === 'playing' && patterns[level] && (
            <div className="space-y-6">
              <div className="text-center">
                <div className="inline-block bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-full text-lg font-bold mb-4">
                  레벨 {level}: {patterns[level].name}
                </div>
                <p className="text-gray-700 text-lg">{patterns[level].description}</p>
              </div>

              {/* 정확도 바 */}
              <div className="bg-gray-200 rounded-full h-8 overflow-hidden">
                <div
                  className="bg-gradient-to-r from-green-400 to-blue-500 h-full transition-all duration-500 flex items-center justify-center text-white font-bold"
                  style={{ width: `${accuracy}%` }}
                >
                  {accuracy > 10 && `${Math.round(accuracy)}%`}
                </div>
              </div>
              <div className="text-center text-sm text-gray-600">
                AI 학습 정확도 (100%가 되면 테스트!)
              </div>

              {/* 학습 데이터 */}
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <Zap className="w-6 h-6 text-yellow-500" />
                  AI에게 가르쳐주세요!
                </h3>
                <div className="space-y-3">
                  {trainingData.map((data, idx) => (
                    <div key={idx} className="bg-white rounded-xl p-4 shadow-md">
                      <div className="flex items-center justify-between">
                        <div className="text-5xl">{data.item}</div>
                        <div className="flex gap-3">
                          {Object.keys(patterns[level].options[0])
                            .filter(key => key === 'answer')
                            .map(() => {
                              const answers = [...new Set(patterns[level].options.map(o => o.answer))];
                              return answers.map(ans => (
                                <button
                                  key={ans}
                                  onClick={() => trainAI(data, ans)}
                                  className="bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-3 rounded-xl font-bold hover:from-purple-500 hover:to-pink-500 transform hover:scale-105 transition-all"
                                >
                                  {ans}
                                </button>
                              ));
                            })}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {feedback && (
                <div className="text-center text-2xl font-bold animate-pulse">
                  {feedback}
                </div>
              )}
            </div>
          )}

          {gameState === 'result' && currentQuestion && (
            <div className="space-y-6 text-center">
              <div className="text-3xl font-bold text-gray-800">
                🎯 이제 AI를 테스트해봐요!
              </div>
              <div className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-8">
                <p className="text-lg text-gray-700 mb-6">
                  AI가 배운 내용을 바탕으로 새로운 문제를 풀 수 있을까요?
                </p>
                <div className="text-8xl mb-6">{currentQuestion.item}</div>
                <p className="text-xl text-gray-700 mb-6">이것은 무엇일까요?</p>
                <div className="flex gap-4 justify-center">
                  {[...new Set(patterns[level].options.map(o => o.answer))].map(ans => (
                    <button
                      key={ans}
                      onClick={() => answerTest(ans)}
                      className="bg-gradient-to-r from-green-400 to-blue-400 text-white text-xl px-8 py-4 rounded-xl font-bold hover:from-green-500 hover:to-blue-500 transform hover:scale-105 transition-all shadow-lg"
                    >
                      {ans}
                    </button>
                  ))}
                </div>
              </div>
              {feedback && (
                <div className="text-3xl font-bold animate-pulse">
                  {feedback}
                </div>
              )}
            </div>
          )}

          {gameState === 'complete' && (
            <div className="text-center space-y-6">
              <div className="text-6xl mb-4">🏆</div>
              <h2 className="text-4xl font-bold text-gray-800">축하합니다!</h2>
              <div className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-8">
                <p className="text-2xl font-bold text-purple-600 mb-4">
                  총점: {totalScore}점
                </p>
                <div className="mb-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-3">획득한 배지</h3>
                  <div className="flex gap-3 justify-center flex-wrap">
                    {badges.map((badge, idx) => (
                      <div key={idx} className="bg-white rounded-xl px-4 py-2 shadow-md">
                        <Star className="w-6 h-6 text-yellow-500 inline mr-2" />
                        <span className="font-bold text-gray-700">{badge}</span>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="bg-white rounded-xl p-6 mt-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-3">배운 내용 정리</h3>
                  <p className="text-gray-700 leading-relaxed">
                    🎓 <strong>데이터 학습:</strong> AI는 여러 예시를 보면서 패턴을 배워요<br />
                    📈 <strong>정확도 향상:</strong> 많이 연습할수록 더 정확해져요<br />
                    🎯 <strong>예측하기:</strong> 배운 내용으로 새로운 문제를 풀 수 있어요<br />
                  </p>
                </div>
              </div>
              <button
                onClick={() => {
                  setGameState('menu');
                  setLevel(1);
                  setScore(0);
                }}
                className="bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold px-10 py-4 rounded-full hover:from-purple-600 hover:to-pink-600 transform hover:scale-105 transition-all shadow-lg"
              >
                다시 하기
              </button>
            </div>
          )}
        </div>

        {/* 배지 컬렉션 */}
        {badges.length > 0 && gameState !== 'complete' && (
          <div className="mt-6 bg-white rounded-3xl shadow-xl p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
              <Award className="w-6 h-6 text-pink-500" />
              내 배지 컬렉션
            </h3>
            <div className="flex gap-3 flex-wrap">
              {badges.map((badge, idx) => (
                <div key={idx} className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl px-4 py-2">
                  <Star className="w-5 h-5 text-yellow-500 inline mr-2" />
                  <span className="font-bold text-gray-700">{badge}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default DeepLearningGame;
